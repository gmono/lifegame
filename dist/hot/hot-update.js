webpackHotUpdate("commons~main",{

/***/ "./src/main.ts":
/*!*********************!*\
  !*** ./src/main.ts ***!
  \*********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(module) {
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const tf = __importStar(__webpack_require__(/*! @tensorflow/tfjs */ "./node_modules/@tensorflow/tfjs/dist/index.js"));
const lib_1 = __webpack_require__(/*! ../libs/lib */ "./libs/lib.ts");
const Draw_1 = __webpack_require__(/*! ./Draw */ "./src/Draw.ts");
const matrix_rules_1 = __webpack_require__(/*! ./rules/matrix_rules */ "./src/rules/matrix_rules.ts");
function getval(id) {
    let e = document.querySelector(`input#${id}`);
    return e.value;
}
function get(id, tag = null) {
    return document.querySelector(`#${id}`);
}
let a = get("hello");
function create(tag, id, values) {
    let t = document.createElement(tag);
    t.id = id;
    //
    for (let k in values) {
        if (k in t == false)
            continue;
        t[k] = values[k];
    }
    return t;
}
// let rules={
//     b3s23,
//     b1s12,
//     b3678s34678,
//     b36s23,
//     b35678s5678
// }
const matrix_rules_2 = __webpack_require__(/*! ./rules/matrix_rules */ "./src/rules/matrix_rules.ts");
function initSelection() {
    for (let k in matrix_rules_2.Rules) {
        get("rule").appendChild(create("option", k, { innerText: k, value: k }));
    }
}
function get_param(param) {
    var query = location.search.substring(1).split('&');
    for (var i = 0; i < query.length; i++) {
        var kv = query[i].split('=');
        if (kv[0] == param) {
            return kv[1];
        }
    }
    return null;
}
async function main() {
    initSelection();
    let ele = get("canvas");
    let hsize = [1024, 1024];
    ele.height = hsize[0];
    ele.width = hsize[1];
    ele.id = "ctx";
    const rsize = get_param("rsize") == null ? 0.25 : lib_1.float(get_param("rsize"));
    let size = [hsize[0] / rsize, hsize[1] / rsize];
    let d = new Draw_1.Draw(ele, size[0], size[1]);
    let init = () => tf.randomUniform(size, 0, 1, "float32").div(lib_1.float(getval("rel"))).floor().equal(0).asType("int32");
    let dt = init();
    //输出
    get("info").innerText = `${dt.shape[0]}x${dt.shape[1]} (h*w) `;
    get("cinfo").innerText = `${hsize[0]}x${hsize[1]} (h*w)`;
    d.draw2D(dt);
    console.log(dt);
    let p = true;
    let sl = false;
    let n = 0;
    //loop
    async function loop() {
        //输出大小
        let delayt = lib_1.int(getval("delay"));
        //获取规则
        let ruleid = get("rule", "select").selectedOptions[0].value;
        let rule = matrix_rules_2.Rules[ruleid];
        for (;;) {
            await lib_1.delay(delayt);
            let old = dt;
            dt = matrix_rules_1.matrix_rule(old, rule);
            old.dispose();
            // console.log(dt);
            //非静默
            if (!sl)
                await d.draw2D(dt);
            //
            if (p)
                break;
            n++;
            //显示轮
            get("n").innerText = n.toString();
        }
    }
    //event
    get("start").onclick = async () => {
        if (p) {
            p = false;
            loop();
            get("start").style.background = "red";
            get("start").innerText = "暂停";
        }
        else {
            p = true;
            get("start").style.background = "";
            get("start").innerText = "启动";
            d.draw2D(dt);
        }
    };
    get("reset").onclick = async () => {
        dt = init();
        d.draw2D(dt);
        n = 0;
    };
    function changepoint(x, y) {
        if (x < 0 || y < 0)
            return;
        let data = dt.arraySync();
        let tx, ty;
        tx = Math.floor(x / d.cw);
        ty = Math.floor(y / d.ch);
        data[ty][tx] = data[ty][tx] == 0 ? 1 : 0;
        dt.dispose();
        dt = tf.tensor(data);
        d.draw2D(dt);
    }
    function setpoint(x, y, v = 1) {
        if (x < 0 || y < 0)
            return;
        let data = dt.arraySync();
        let tx, ty;
        tx = Math.floor(x / d.cw);
        ty = Math.floor(y / d.ch);
        data[ty][tx] = 1;
        dt.dispose();
        dt = tf.tensor(data);
        d.draw2D(dt);
    }
    get("ctx").onclick = e => {
        if (e.button == 0)
            changepoint(e.offsetX, e.offsetY);
    };
    get("ctx").onmousemove = e => {
        if (e.buttons === 1) {
            setpoint(e.offsetX, e.offsetY, 1);
        }
    };
    get("sl").onclick = () => {
        sl = !sl;
        if (sl)
            get("sl").style.background = "red";
        else
            get("sl").style.background = "";
    };
}
window.onload = main;
console.log("helloworld");
const mod = module;
if (mod.hot)
    mod.hot.accept();
console.log(mod.hot);
mod.addDisposeHandler(() => {
    console.log("hello");
});

/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../node_modules/webpack/buildin/module.js */ "./node_modules/webpack/buildin/module.js")(module)))

/***/ })

})
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvbWFpbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsc0hBQXNDO0FBQ3RDLHNFQUFnRDtBQUNoRCxrRUFBOEI7QUFDOUIsc0dBQXdEO0FBRXhELFNBQVMsTUFBTSxDQUFDLEVBQVM7SUFDckIsSUFBSSxDQUFDLEdBQUUsUUFBUSxDQUFDLGFBQWEsQ0FBQyxTQUFTLEVBQUUsRUFBRSxDQUFxQixDQUFDO0lBQ2pFLE9BQU8sQ0FBQyxDQUFDLEtBQUssQ0FBQztBQUNuQixDQUFDO0FBQ0QsU0FBUyxHQUFHLENBQXdCLEVBQVMsRUFBQyxNQUFNLElBQUk7SUFDcEQsT0FBTyxRQUFRLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxFQUFFLENBQWEsQ0FBQztBQUN4RCxDQUFDO0FBQ0QsSUFBSSxDQUFDLEdBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQztBQVNsQixTQUFTLE1BQU0sQ0FBaUQsR0FBTSxFQUFDLEVBQVMsRUFBQyxNQUFhO0lBQzFGLElBQUksQ0FBQyxHQUFFLFFBQVEsQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDO0lBQ2xDLENBQUMsQ0FBQyxFQUFFLEdBQUMsRUFBRSxDQUFDO0lBQ1IsRUFBRTtJQUNGLEtBQUksSUFBSSxDQUFDLElBQUksTUFBTSxFQUFDO1FBQ2hCLElBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxLQUFLO1lBQUUsU0FBUztRQUM3QixDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQ2xCO0lBQ0QsT0FBTyxDQUF3QixDQUFDO0FBQ3BDLENBQUM7QUFFRCxjQUFjO0FBQ2QsYUFBYTtBQUNiLGFBQWE7QUFDYixtQkFBbUI7QUFDbkIsY0FBYztBQUNkLGtCQUFrQjtBQUNsQixJQUFJO0FBQ0osc0dBQW1EO0FBQ25ELFNBQVMsYUFBYTtJQUVsQixLQUFJLElBQUksQ0FBQyxJQUFJLG9CQUFLLEVBQUM7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QyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBVSxHQUFDLEtBQUssQ0FBQzs7WUFDbkMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFVLEdBQUMsRUFBRSxDQUFDO0lBQ3ZDLENBQUM7QUFHTCxDQUFDO0FBQ0QsTUFBTSxDQUFDLE1BQU0sR0FBQyxJQUFJLENBQUM7QUFDbkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUUxQixNQUFNLEdBQUcsR0FBRyxNQUFjLENBQUM7QUFDM0IsSUFBRyxHQUFHLENBQUMsR0FBRztJQUNSLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUM7QUFDbkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDO0FBQ3BCLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxHQUFFLEVBQUU7SUFDdEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUN6QixDQUFDLENBQUMiLCJmaWxlIjoiaG90L2hvdC11cGRhdGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyB0ZiBmcm9tIFwiQHRlbnNvcmZsb3cvdGZqc1wiXHJcbmltcG9ydCB7IGRlbGF5LCBpbnQsIGZsb2F0IH0gZnJvbSAnLi4vbGlicy9saWInO1xyXG5pbXBvcnQgeyBEcmF3IH0gZnJvbSBcIi4vRHJhd1wiO1xyXG5pbXBvcnQgeyBtYXRyaXhfcnVsZSwgUnVsZX0gZnJvbSAnLi9ydWxlcy9tYXRyaXhfcnVsZXMnO1xyXG5cclxuZnVuY3Rpb24gZ2V0dmFsKGlkOnN0cmluZyl7XHJcbiAgICBsZXQgZT0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgaW5wdXQjJHtpZH1gKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgcmV0dXJuIGUudmFsdWU7XHJcbn1cclxuZnVuY3Rpb24gZ2V0PFIgZXh0ZW5kcyBrZXlvZiB0YWJsZT4oaWQ6c3RyaW5nLHRhZzpSPW51bGwpOnRhYmxlW1Jde1xyXG4gICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2lkfWApIGFzIHRhYmxlW1JdO1xyXG59XHJcbmxldCBhPWdldChcImhlbGxvXCIpXHJcblxyXG50eXBlIHRhYmxlPXtcclxuICAgIG9wdGlvbjpIVE1MT3B0aW9uRWxlbWVudCxcclxuICAgIGRpdjpIVE1MRGl2RWxlbWVudCxcclxuICAgIGlucHV0OkhUTUxJbnB1dEVsZW1lbnQsXHJcbiAgICBcIipcIjpIVE1MRWxlbWVudCxcclxuICAgIHNlbGVjdDpIVE1MU2VsZWN0RWxlbWVudFxyXG59XHJcbmZ1bmN0aW9uIGNyZWF0ZTxUIGV4dGVuZHMga2V5b2YgdGFibGUsUiBleHRlbmRzIGtleW9mIHRhYmxlW1RdPih0YWc6IFQsaWQ6c3RyaW5nLHZhbHVlczpvYmplY3QpOnRhYmxlW1Rde1xyXG4gICAgbGV0IHQ9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKVxyXG4gICAgdC5pZD1pZDtcclxuICAgIC8vXHJcbiAgICBmb3IobGV0IGsgaW4gdmFsdWVzKXtcclxuICAgICAgICBpZihrIGluIHQgPT0gZmFsc2UpIGNvbnRpbnVlO1xyXG4gICAgICAgIHRba109dmFsdWVzW2tdO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHQgYXMgdW5rbm93biBhcyB0YWJsZVtUXTtcclxufVxyXG5cclxuLy8gbGV0IHJ1bGVzPXtcclxuLy8gICAgIGIzczIzLFxyXG4vLyAgICAgYjFzMTIsXHJcbi8vICAgICBiMzY3OHMzNDY3OCxcclxuLy8gICAgIGIzNnMyMyxcclxuLy8gICAgIGIzNTY3OHM1Njc4XHJcbi8vIH1cclxuaW1wb3J0IHtSdWxlcyBhcyBydWxlc30gZnJvbSBcIi4vcnVsZXMvbWF0cml4X3J1bGVzXCJcclxuZnVuY3Rpb24gaW5pdFNlbGVjdGlvbigpXHJcbntcclxuICAgIGZvcihsZXQgayBpbiBydWxlcyl7XHJcbiAgICAgICAgZ2V0KFwicnVsZVwiKS5hcHBlbmRDaGlsZChjcmVhdGUoXCJvcHRpb25cIixrLHtpbm5lclRleHQ6ayx2YWx1ZTprfSkpXHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldF9wYXJhbShwYXJhbTpzdHJpbmcpe1xyXG4gICAgdmFyIHF1ZXJ5ID0gbG9jYXRpb24uc2VhcmNoLnN1YnN0cmluZygxKS5zcGxpdCgnJicpO1xyXG4gICAgZm9yKHZhciBpPTA7aTxxdWVyeS5sZW5ndGg7aSsrKXtcclxuICAgICAgICB2YXIga3YgPSBxdWVyeVtpXS5zcGxpdCgnPScpO1xyXG4gICAgICAgIGlmKGt2WzBdID09IHBhcmFtKXtcclxuICAgICAgICAgICAgcmV0dXJuIGt2WzFdO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBtYWluKCl7XHJcbiAgICBpbml0U2VsZWN0aW9uKCk7XHJcblxyXG4gICAgbGV0IGVsZT1nZXQoXCJjYW52YXNcIikgYXMgSFRNTENhbnZhc0VsZW1lbnQ7XHJcbiAgICBsZXQgaHNpemU9WzEwMjQsMTAyNF1cclxuICAgIGVsZS5oZWlnaHQ9aHNpemVbMF07XHJcbiAgICBlbGUud2lkdGg9aHNpemVbMV07XHJcbiAgICBlbGUuaWQ9XCJjdHhcIlxyXG4gICAgY29uc3QgcnNpemU9Z2V0X3BhcmFtKFwicnNpemVcIik9PW51bGw/IDAuMjU6ZmxvYXQoZ2V0X3BhcmFtKFwicnNpemVcIikpXHJcbiAgICBsZXQgc2l6ZT1baHNpemVbMF0vcnNpemUsaHNpemVbMV0vcnNpemVdXHJcbiAgICBsZXQgZD1uZXcgRHJhdyhlbGUsc2l6ZVswXSxzaXplWzFdKTtcclxuXHJcbiAgICBsZXQgaW5pdD0oKT0+dGYucmFuZG9tVW5pZm9ybShzaXplLDAsMSxcImZsb2F0MzJcIikuZGl2KGZsb2F0KGdldHZhbChcInJlbFwiKSkpLmZsb29yKCkuZXF1YWwoMCkuYXNUeXBlKFwiaW50MzJcIikgYXMgdGYuVGVuc29yMkRcclxuICAgIGxldCBkdD1pbml0KCk7XHJcbiAgICAvL+i+k+WHulxyXG4gICAgZ2V0KFwiaW5mb1wiKS5pbm5lclRleHQ9YCR7ZHQuc2hhcGVbMF19eCR7ZHQuc2hhcGVbMV19IChoKncpIGBcclxuICAgIGdldChcImNpbmZvXCIpLmlubmVyVGV4dD1gJHtoc2l6ZVswXX14JHtoc2l6ZVsxXX0gKGgqdylgXHJcblxyXG4gICAgZC5kcmF3MkQoZHQpO1xyXG4gICAgY29uc29sZS5sb2coZHQpO1xyXG4gICAgbGV0IHA9dHJ1ZTtcclxuICAgIGxldCBzbD1mYWxzZTtcclxuICAgIGxldCBuPTA7XHJcbiAgICAvL2xvb3BcclxuICAgIGFzeW5jIGZ1bmN0aW9uIGxvb3AoKXtcclxuICAgICAgICAvL+i+k+WHuuWkp+Wwj1xyXG4gICAgICAgIGxldCBkZWxheXQ9aW50KGdldHZhbChcImRlbGF5XCIpKTtcclxuICAgICAgICAvL+iOt+WPluinhOWImVxyXG4gICAgICAgIGxldCBydWxlaWQ9Z2V0KFwicnVsZVwiLFwic2VsZWN0XCIpLnNlbGVjdGVkT3B0aW9uc1swXS52YWx1ZTtcclxuICAgICAgICBsZXQgcnVsZT1ydWxlc1tydWxlaWRdIGFzIFJ1bGU7XHJcbiAgICAgICAgZm9yKDs7KXtcclxuICAgICAgICAgICAgYXdhaXQgZGVsYXkoZGVsYXl0KTtcclxuICAgICAgICAgICAgbGV0IG9sZD1kdDtcclxuICAgICAgICAgICAgZHQ9bWF0cml4X3J1bGUob2xkLHJ1bGUpO1xyXG4gICAgICAgICAgICBvbGQuZGlzcG9zZSgpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZHQpO1xyXG4gICAgICAgICAgICAvL+mdnumdmem7mFxyXG4gICAgICAgICAgICBpZighc2wpXHJcbiAgICAgICAgICAgICAgICBhd2FpdCBkLmRyYXcyRChkdCk7XHJcbiAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgIGlmKHApIGJyZWFrO1xyXG4gICAgICAgICAgICBuKys7XHJcbiAgICAgICAgICAgIC8v5pi+56S66L2uXHJcbiAgICAgICAgICAgIGdldChcIm5cIikuaW5uZXJUZXh0PW4udG9TdHJpbmcoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAgLy9ldmVudFxyXG4gICAgZ2V0KFwic3RhcnRcIikub25jbGljaz1hc3luYygpPT57XHJcbiAgICAgICAgaWYocCl7XHJcbiAgICAgICAgICAgIHA9ZmFsc2U7XHJcbiAgICAgICAgICAgIGxvb3AoKTtcclxuICAgICAgICAgICAgZ2V0KFwic3RhcnRcIikuc3R5bGUuYmFja2dyb3VuZD1cInJlZFwiXHJcbiAgICAgICAgICAgIGdldChcInN0YXJ0XCIpLmlubmVyVGV4dD1cIuaaguWBnFwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICBwPXRydWU7XHJcbiAgICAgICAgICAgIGdldChcInN0YXJ0XCIpLnN0eWxlLmJhY2tncm91bmQ9XCJcIlxyXG4gICAgICAgICAgICBnZXQoXCJzdGFydFwiKS5pbm5lclRleHQ9XCLlkK/liqhcIjtcclxuICAgICAgICAgICAgZC5kcmF3MkQoZHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgIH07XHJcbiAgICBcclxuXHJcbiAgICBnZXQoXCJyZXNldFwiKS5vbmNsaWNrPWFzeW5jKCk9PntcclxuICAgICAgICBkdD1pbml0KCk7XHJcbiAgICAgICAgZC5kcmF3MkQoZHQpO1xyXG4gICAgICAgIG49MDtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjaGFuZ2Vwb2ludCh4LHkpe1xyXG4gICAgICAgIGlmKHg8MHx8eTwwKSByZXR1cm47XHJcbiAgICAgICAgbGV0IGRhdGE9ZHQuYXJyYXlTeW5jKCk7XHJcbiAgICAgICAgbGV0IHR4LHR5O1xyXG4gICAgICAgIHR4PU1hdGguZmxvb3IoeC9kLmN3KTtcclxuICAgICAgICB0eT1NYXRoLmZsb29yKHkvZC5jaClcclxuICAgICAgICBkYXRhW3R5XVt0eF09ZGF0YVt0eV1bdHhdPT0wPyAxOjA7XHJcbiAgICAgICAgZHQuZGlzcG9zZSgpO1xyXG4gICAgICAgIGR0PXRmLnRlbnNvcihkYXRhKTtcclxuICAgICAgICBkLmRyYXcyRChkdCk7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBzZXRwb2ludCh4LHksdj0xKXtcclxuICAgICAgICBpZih4PDB8fHk8MCkgcmV0dXJuO1xyXG4gICAgICAgIGxldCBkYXRhPWR0LmFycmF5U3luYygpO1xyXG4gICAgICAgIGxldCB0eCx0eTtcclxuICAgICAgICB0eD1NYXRoLmZsb29yKHgvZC5jdyk7XHJcbiAgICAgICAgdHk9TWF0aC5mbG9vcih5L2QuY2gpXHJcbiAgICAgICAgZGF0YVt0eV1bdHhdPTE7XHJcbiAgICAgICAgZHQuZGlzcG9zZSgpO1xyXG4gICAgICAgIGR0PXRmLnRlbnNvcihkYXRhKTtcclxuICAgICAgICBkLmRyYXcyRChkdCk7XHJcbiAgICB9XHJcbiAgICBnZXQoXCJjdHhcIikub25jbGljaz1lPT57XHJcbiAgICAgICAgaWYoZS5idXR0b249PTApXHJcbiAgICAgICAgICAgIGNoYW5nZXBvaW50KGUub2Zmc2V0WCxlLm9mZnNldFkpO1xyXG4gICAgfVxyXG4gICAgZ2V0KFwiY3R4XCIpLm9ubW91c2Vtb3ZlPWU9PntcclxuICAgICAgICBpZihlLmJ1dHRvbnM9PT0xKXtcclxuICAgICAgICAgICAgc2V0cG9pbnQoZS5vZmZzZXRYLGUub2Zmc2V0WSwxKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXQoXCJzbFwiKS5vbmNsaWNrPSgpPT57XHJcbiAgICAgICAgc2w9IXNsO1xyXG4gICAgICAgIGlmKHNsKSBnZXQoXCJzbFwiKS5zdHlsZS5iYWNrZ3JvdW5kPVwicmVkXCI7XHJcbiAgICAgICAgZWxzZSBnZXQoXCJzbFwiKS5zdHlsZS5iYWNrZ3JvdW5kPVwiXCI7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIFxyXG59XHJcbndpbmRvdy5vbmxvYWQ9bWFpbjtcclxuY29uc29sZS5sb2coXCJoZWxsb3dvcmxkXCIpO1xyXG5cclxuY29uc3QgbW9kPSAobW9kdWxlIGFzIGFueSk7XHJcbmlmKG1vZC5ob3QpXHJcbiAgbW9kLmhvdC5hY2NlcHQoKTtcclxuY29uc29sZS5sb2cobW9kLmhvdClcclxubW9kLmFkZERpc3Bvc2VIYW5kbGVyKCgpPT57XHJcbiAgICBjb25zb2xlLmxvZyhcImhlbGxvXCIpO1xyXG59KSJdLCJzb3VyY2VSb290IjoiIn0=